# セクション15: [発展] パフォーマンスの最適化

## 157. [レンダリング] 画面が更新されるまで

### Reactが画面を更新する流れ

+ __トリガー__ : 何らかの契機にレンダリングを予約すること<br>

↓<br>

+ __レンダリング__ : コンポーネントを実行すること<br>

↓<br>

+ __コミット__ : DOM値の更新を行右こと<br>

### レンダリングがトリガーされるタイミング

1. __初回レンダリング__<br>
    ルートコンポーネントをHTML(DOM)にマウントした時<br>
    `<div id="app"></div> <= root.render(<App />);`<br>

2. __"state"の値が変更されたとき__<br>
    コンポーネントのstateの値が変更された時<br>
    `＊` 基本的にはstateの前後の値に差が生じた際にレンダリングがスケジュールされる<br>

### stateの比較

__"更新用関数で渡された値①"と"保持している値②"を比較__<br>

```jsx:Sample.jsx
const Example = () => {

  let [val, setVal] = useState();
  return (
    <>
      <input
        type="text"
        onChange={(e) => {
          setVal(e.target.value); // 更新用関数でstateに新しい値を渡す。
        }}
      />
      = {val}
    </>
  )
}
```

### stateの変更前後で値が同じ時も再レンダリングが発生することはある

#### state 更新の回避

現在値と同じ値で更新を行った場合、Reactは子のレンダーや副作用の実行を回避して処理を終了します。<br>

__更新の回避が起きる前にReactにとり該当のコンポーネント自体はレンダーされるかもしれない、ということに注意してください。__<br>
ツリーのそれ以上「深く」にまで処理は及ばないためこれは問題ではないはずです。<br>
もしレンダー中にコストの高い計算を行っている場合は `useMemo`を使った最適化が可能です。<br>

(参考) [React公式（state更新の回避)](https://ja.reactjs.org/docs/hooks-reference.html#bailing-out-of-a-state-update) <br>

### レンダリング

__Reactは(関数)コンポーネントを実行すること__<br>

↓<br>

stateの変更によってコンポーネントが__再実行__されることを__再レンダリング__と呼ぶ！<br>


### コミット

__再レンダリング の結果、ReactがReact要素の差分のみをDOMに反映する__<br>
